<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GitImage-Force</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background-color: #f0f4f8;
    }
    .container {
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
    }
    .preview img {
      max-width: 100%;
      height: auto;
      border-radius: 8px;
      margin-top: 10px;
    }
    .result {
      word-break: break-all;
      background-color: #e2e8f0;
      padding: 10px;
      border-radius: 8px;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div class="container mx-auto p-6 bg-white shadow-lg rounded-lg">
    <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">GitHub Image Uploader</h1>
    
    <div class="mb-4">
      <label class="block text-gray-700 font-semibold mb-2" for="token">GitHub Personal Access Token</label>
      <input type="text" id="token" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Enter your GitHub PAT">
      <p class="text-sm text-gray-500 mt-1">Create a token with 'repo' scope at <a href="https://github.com/settings/tokens" target="_blank" class="text-blue-600 hover:underline">GitHub Settings</a></p>
    </div>
    
    <div class="mb-4">
      <label class="block text-gray-700 font-semibold mb-2" for="repo">Repository Name</label>
      <input type="text" id="repo" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="e.g., username/repo">
    </div>
    
    <div class="mb-4">
      <label class="block text-gray-700 font-semibold mb-2" for="file">Upload Image</label>
      <input type="file" id="file" accept="image/*" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
      <div id="preview" class="preview mt-2"></div>
    </div>
    
    <button id="uploadBtn" class="w-full bg-blue-600 text-white font-semibold p-3 rounded-lg hover:bg-blue-700 transition duration-300">Upload Image</button>
    
    <div id="result" class="result hidden">
      <h3 class="text-lg font-semibold text-gray-800">Result</h3>
      <p id="imageUrl" class="text-gray-700"></p>
      <p class="text-sm text-gray-500 mt-2">Copy this URL to your README.md to display the image:</p>
      <p id="markdown" class="text-gray-700 font-mono"></p>
    </div>
  </div>

  <script>
    const tokenInput = document.getElementById('token');
    const repoInput = document.getElementById('repo');
    const fileInput = document.getElementById('file');
    const uploadBtn = document.getElementById('uploadBtn');
    const preview = document.getElementById('preview');
    const result = document.getElementById('result');
    const imageUrl = document.getElementById('imageUrl');
    const markdown = document.getElementById('markdown');

    // Preview image before upload
    fileInput.addEventListener('change', () => {
      const file = fileInput.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (e) => {
          preview.innerHTML = `<img src="${e.target.result}" alt="Image Preview">`;
        };
        reader.readAsDataURL(file);
      } else {
        preview.innerHTML = '';
      }
    });

    // Upload image to GitHub
    uploadBtn.addEventListener('click', async () => {
      const token = tokenInput.value.trim();
      const repo = repoInput.value.trim();
      const file = fileInput.files[0];

      if (!token || !repo || !file) {
        alert('Please fill in all fields: GitHub token, repository name, and select an image.');
        return;
      }

      uploadBtn.textContent = 'Uploading...';
      uploadBtn.disabled = true;

      try {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = async () => {
          const base64Content = reader.result.split(',')[1];
          const fileName = file.name;
          const path = `images/${fileName}`;
          const commitMessage = `Upload ${fileName} via website`;

          const response = await fetch(`https://api.github.com/repos/${repo}/contents/${path}`, {
            method: 'PUT',
            headers: {
              'Authorization': `token ${token}`,
              'Content-Type': 'application/json',
              'Accept': 'application/vnd.github.v3+json'
            },
            body: JSON.stringify({
              message: commitMessage,
              content: base64Content
            })
          });

          const data = await response.json();

          if (response.ok) {
            const url = data.content.download_url;
            imageUrl.textContent = `Image URL: ${url}`;
            markdown.textContent = `![${fileName}](${url})`;
            result.classList.remove('hidden');
          } else {
            alert(`Error: ${data.message || 'Failed to upload image'}`);
          }
        };
      } catch (error) {
        alert(`Error: ${error.message}`);
      } finally {
        uploadBtn.textContent = 'Upload Image';
        uploadBtn.disabled = false;
      }
    });
  </script>
</body>
</html>